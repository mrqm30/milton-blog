---
import { withBase as to, samePath } from '../lib/paths';

const links = [
  { href: '', label: 'Inicio' },
  { href: 'about', label: 'Sobre mÃ­' },
  { href: 'career', label: 'Vida profesional' },
  { href: 'projects', label: 'Proyectos' },
  { href: 'publications', label: 'Publicaciones' },
  { href: 'skills', label: 'Habilidades' },
  { href: 'interests', label: 'Intereses' },
  { href: 'contact', label: 'Contacto' },
];

const current = Astro.url.pathname;
const isActive = (p:string) => samePath(current, to(p));
---
<nav class="sticky top-3 z-50 container-p animate-fade-in">
  <div class="glass flex items-center justify-between gap-4 px-3 py-2">
    <a href={to('')} class="no-underline font-semibold text-[var(--c-ink)]">Milton QM</a>

    <details class="md:hidden">
      <summary class="cursor-pointer px-3 py-2 rounded-lg border border-[var(--c-border)]">MenÃº</summary>
      <ul class="mt-2 space-y-2 p-2 surface">
        {links.map(l => (
          <li>
            <a href={to(l.href)} aria-current={isActive(l.href)?'page':undefined}
               class={`nav-pill nav-underline link-clean ${isActive(l.href) ? 'is-active bg-[var(--c-accent)] text-white' : 'hover:bg-[var(--c-accent-2)]/12'}`}>
              {l.label}
            </a>
          </li>
        ))}
        <li class="pt-2 border-t border-[var(--c-border)]">
          <button class="w-full px-3 py-2 rounded-lg border border-[var(--c-border)]" onclick="(function(){
            const el=document.documentElement; el.classList.toggle('dark');
            localStorage.setItem('theme', el.classList.contains('dark')?'dark':'light');
          })()">ðŸŒ“ Tema</button>
        </li>
      </ul>
    </details>

    <ul class="hidden md:flex items-center gap-1">
      {links.map(l => (
        <li>
          <a href={to(l.href)} aria-current={isActive(l.href)?'page':undefined}
             class={`nav-pill nav-underline link-clean ${isActive(l.href) ? 'is-active bg-[var(--c-accent)] text-white' : 'hover:bg-[var(--c-accent-2)]/12'}`}>
            {l.label}
          </a>
        </li>
      ))}
      <li>
        <button class="ml-1 px-3 py-2 rounded-lg border border-[var(--c-border)]" onclick="(function(){
          const el=document.documentElement; el.classList.toggle('dark');
          localStorage.setItem('theme', el.classList.contains('dark')?'dark':'light');
        })()">ðŸŒ“</button>
      </li>
    </ul>
  </div>

  <script is:inline>
    (function(){
      const pref=localStorage.getItem('theme');
      if(pref){ if(pref==='dark') document.documentElement.classList.add('dark'); }
      else if(window.matchMedia('(prefers-color-scheme: dark)').matches){
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</nav>
